name: Publish release

on:
  workflow_dispatch:
    inputs:
      max-matlab-release:
        required: true
        type: string
      version-number:
        required: true
        type: string

jobs:
  publish_release:
    name: Publish release
    runs-on: ubuntu-24.04
    permissions:
      contents: write
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
      - name: Set up MATLAB
        uses: matlab-actions/setup-matlab@v2
        with:
          cache: true
          release: R2024a
      - name: Build package
        uses: matlab-actions/run-build@v2
        with:
          tasks: package(VersionNumber="${{ github.event.inputs.version-number }}", MaximumMatlabRelease="${{ github.event.inputs.max-matlab-release }}")
      - name: Create release
        uses: ncipollo/release-action@v1
        with:
          artifacts: "release/*.mltbx"
          draft: true
          commit: main
          tag: v${{ github.event.inputs.version-number }}
      - name: Publish release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          updateOnlyUnreleased: true
          draft: false
          tag: v${{ github.event.inputs.version-number }}

# cspell:words mltbx ncipollo
